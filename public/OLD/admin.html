<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin</title>
</head>
<body>
    <section class="admin_section">
        <input type="file" placeholder="time" id="myFile">
        <input type="text" placeholder="time" id="time">
        <input type="text" placeholder="title" id="title">
        <textarea id="description"></textarea>
        <input type="text" placeholder="slug" id="slug">
        <input type="button" value="Save" id="save_item">
    </section>
    <section id="admin_section" class="admin_section">admin</section>
    <script type="module">
        const firebaseConfig = {
            apiKey: "AIzaSyBoC2t2yfoMY6dAU67HuQerDeygvgK7uIo",
            authDomain: "skrepeckiy.firebaseapp.com",
            databaseURL: "https://skrepeckiy-default-rtdb.europe-west1.firebasedatabase.app",
            projectId: "skrepeckiy",
            storageBucket: "skrepeckiy.appspot.com",
            messagingSenderId: "84562251992",
            appId: "1:84562251992:web:e820e3303f1221f2ee87ad",
            measurementId: "G-VZHLXLSYRX"
        }
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.9.4/firebase-app.js";
        import { getFirestore, doc, getDoc, collection, getDocs } from "https://www.gstatic.com/firebasejs/9.9.4/firebase-firestore.js";
        import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/9.9.4/firebase-auth.js"
        const app = initializeApp(firebaseConfig)
        const firestore = getFirestore(app)
        const auth = getAuth(app) 

        signInWithEmailAndPassword(auth, window.localStorage.getItem('email'), window.localStorage.getItem('password')).then((userCredential) => {
             const user = userCredential.user;
             is_admin_function(window.localStorage.getItem('uid'))
        }).catch((error) => {
          // window.location.href = '/register.html'  
          const errorCode = error.code;       console.log('errorCode =>', errorCode)
          const errorMessage = error.message; console.log('errorMessage =>', errorMessage)  
        })

        async function is_admin_function(key_admin){
            const docRef = doc(firestore, key_admin, key_admin);
            const docSnap = await getDoc(docRef);
            if (docSnap.exists()) {
                if(docSnap.data().uid == key_admin){
                  console.log('IS ADMIN PROFILE')
                  const docRef = collection(firestore, "items")
                  const docsSnap = await getDocs(docRef)
                  get_list_all_images(docsSnap)
                }
            } else {
                window.location.href = '/user.html'
            }
        }
    </script>
    <script>
        document.title = window.localStorage.getItem('email') + ' ' + window.localStorage.getItem('password')        
    </script>
    <script src="/wp-content/js/admin.get_list_images.js"></script>
    <script src="/wp-content/js/admin.trasliterate.js"></script>
    <script type="module" src="/wp-content/js/admin.save_new_item.js"></script>
    <style>
        .admin_section{margin-left: 5%; width: 90%;}
        .image{width: 200px; height: auto;}
        input, textarea{display: block; width: 99%; margin-top: 11px;}
        textarea{height: 111px;}
        #save_item{width: 70px; margin-bottom: 22px;}
    </style>
</body>
</html>