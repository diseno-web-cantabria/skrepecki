<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>User</title>
</head>
<body>
    <p>user</p>
    <script type="module">
        const firebaseConfig = {
            apiKey: "AIzaSyBoC2t2yfoMY6dAU67HuQerDeygvgK7uIo",
            authDomain: "skrepeckiy.firebaseapp.com",
            databaseURL: "https://skrepeckiy-default-rtdb.europe-west1.firebasedatabase.app",
            projectId: "skrepeckiy",
            storageBucket: "skrepeckiy.appspot.com",
            messagingSenderId: "84562251992",
            appId: "1:84562251992:web:e820e3303f1221f2ee87ad",
            measurementId: "G-VZHLXLSYRX"
        }
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.9.4/firebase-app.js";
        import { getFirestore, doc, getDoc, collection, getDocs } from "https://www.gstatic.com/firebasejs/9.9.4/firebase-firestore.js";
        import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/9.9.4/firebase-auth.js"
        const app = initializeApp(firebaseConfig)
        const firestore = getFirestore(app)
        const auth = getAuth(app) 

        signInWithEmailAndPassword(auth, window.localStorage.getItem('email'), window.localStorage.getItem('password')).then((userCredential) => {
             const user = userCredential.user;
             is_admin_function(window.localStorage.getItem('uid'))
        }).catch((error) => {
          // window.location.href = '/register.html'  
          const errorCode = error.code;       console.log('errorCode =>', errorCode)
          const errorMessage = error.message; console.log('errorMessage =>', errorMessage)  
        })

        async function is_admin_function(key_admin){
            const firestore = getFirestore(app)
            const docRef = doc(firestore, key_admin, key_admin);
            const docSnap = await getDoc(docRef);
            if (docSnap.exists()) {
                if(docSnap.data().uid == key_admin){
                    window.location.href = '/admin.html'
                }
            } else {
                console.log('This is user ' + window.localStorage.getItem('email') + ' ' + window.localStorage.getItem('password'))
            }
        }
    </script>
    <script>


        document.title = window.localStorage.getItem('email') + ' ' + window.localStorage.getItem('password')
        console.log('email=' + window.localStorage.getItem('email') + ', ' + 'password=' + window.localStorage.getItem('password') + ', ' + 'uid=' + window.localStorage.getItem('uid'))
    </script>
</body>
</html>